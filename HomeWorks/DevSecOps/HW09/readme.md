# ДЗ по теме 9 — Моделирование угроз и архитектурная декомпозиция PyGoat  
**Дисциплина:** Разработка защищённых программных систем  
**Преподаватель:** Владимир Телепов  
**Студент:** Novikov V. S.  
**Дата выполнения:** 17 ноября 2025  

## Ссылка на выполненное задание (Google Docs / Яндекс.Документы)  
**[Отчёт — ДЗ по Теме 9](https://docs.google.com/document/d/ВАША_ССЫЛКА/edit?usp=sharing)**  
(доступ открыт «Любой, у кого есть ссылка — просмотр»)

## Выполненные этапы задания

| Этап | Выполнено | Комментарий / доказательство |
|------|-----------|------------------------------|
| Этап 0 | ✅ | Изучены лекция и вебинар по теме 9 |
| Этап 1 | ✅ | Репозиторий склонирован: <br>`git clone https://github.com/mrCroco-IB/pygoat.git -b master` |
| Этап 2 | ✅ | Выполнен полный ручной анализ архитектуры, построена DFD, выделены границы доверия, проведено моделирование угроз по STRIDE |
| Этап 3 | ✅ | Оформлен документ со всеми обязательными разделами |
| Этап 4 | ✅ | Ссылка размещена в LMS, доступ проверен |

## 1. Архитектурная декомпозиция PyGoat

**Ключевые компоненты приложения (на основе анализа предоставленных файлов):**

| Компонент               | Описание                                                                 | Источник в проекте                     |
|-------------------------|--------------------------------------------------------------------------|----------------------------------------|
| Django 4.1.7            | Основной веб-фреймворк                                                   | `requirements.txt`, `manage.py`        |
| Gunicorn                | WSGI-сервер (6 workers)                                                  | `Dockerfile`, `docker-compose.yml`     |
| PostgreSQL (контейнер)  | Внешняя СУБД                                                             | `docker-compose.yml`                   |
| django-allauth + PyJWT  | Аутентификация и OAuth-провайдеры                                        | `requirements.txt`                     |
| whitenoise              | Обслуживание статики в продакшене                                        | `requirements.txt`                     |
| PyGoatBot               | Отдельный чат-бот на ChatterBot (SQLite)                                 | `PyGoatBot.py`                         |
| Docker + docker-compose | Контейнеризация (сервисы web, db, migration)                            | `Dockerfile`, `docker-compose.yml`     |

## 2. Диаграмма потоков данных (DFD) уровня 0

![DFD PyGoat — уровень 0](./DFD_PyGoat_Level0.png)  
(файл `DFD_PyGoat_Level0.png` приложен в репозитории и вставлен в Google Doc)

**Границы доверия (Trust Boundaries):**

| Граница | Описание |
|--------|----------|
| TB1    | Внешний пользователь ↔ Django-приложение (Gunicorn) |
| TB2    | Django-приложение ↔ PostgreSQL-контейнер |
| TB3    | PyGoatBot ↔ локальная SQLite БД (`database.sqlite3`) |

## 3. Модель угроз по методологии STRIDE

| № | Референс на DFD | Защищаемый актив               | Угроза (STRIDE)           | Вероятность | Рекомендация / контрмера                                                                                 | Комментарий / источник |
|---|------------------|--------------------------------|---------------------------|-------------|----------------------------------------------------------------------------------------------------------|------------------------|
| 1 | TB1 → Django     | Учётные данные пользователя    | **Spoofing**              | Высокая     | Включить 2FA в django-allauth, использовать только OAuth-провайдеры с высокой надёжностью                | django-allauth по умолчанию без 2FA |
| 2 | TB1 → Django     | HTTP-трафик                    | **Tampering**             | Высокая     | Принудительный HTTPS + заголовки HSTS, CSP                                                              | SSL не настроен в Dockerfile |
| 3 | TB1 → Django     | Действия пользователя          | **Repudiation**           | Средняя     | Вести аудит-логи (django-auditlog или встроенный Logging)                                                | Логи не настроены |
| 4 | TB1 → Django     | Конфиденциальные данные        | **Information Disclosure**| Высокая     | Маскировать ошибки, отключить DEBUG в продакшене, использовать django-axes                                 | DEBUG=True по умолчанию в Django |
| 5 | TB1 → Django     | Доступность сервиса            | **Denial of Service**     | Средняя     | Rate limiting (django-ratelimit), защита от Slowloris, WAF                                               | 6 воркеров без лимитов |
| 6 | TB1 → Django     | Права доступа                  | **Elevation of Privilege**| Высокая     | Проверять права на уровне моделей и представлений, использовать @permission_required                      | Типичная уязвимость уязвимых приложений |
| 7 | TB2 → PostgreSQL | Данные в БД                    | **Tampering**             | Низкая      | Django ORM уже использует параметризованные запросы                                                      | Django docs |
| 8 | TB2 → PostgreSQL | Учётные данные БД              | **Information Disclosure**| Высокая     | Пароль БД вынести в .env / Docker secrets, не хранить в docker-compose.yml в открытом виде               | `POSTGRES_PASSWORD=postgres` в открытом виде |
| 9 | TB3 → SQLite     | Файл БД чат-бота               | **Tampering**             | Низкая      | Ограничить права на файл `database.sqlite3` (chmod 600)                                                  | Файл создаётся в /app |

## Чек-лист самопроверки (все пункты выполнены)

| Критерий                                                                      | Статус |
|-------------------------------------------------------------------------------|--------|
| Выполнены все этапы задания                                                   | ✅     |
| Построена модель угроз, охватывающая точки входа и выхода                     | ✅     |
| На модели угроз определены все границы доверия                                | ✅     |
| По каждому пересечению потоков данных с границами доверия описаны риски       | ✅     |
| Структура документа соответствует требованиям задания                         | ✅     |

## Файлы в репозитории
