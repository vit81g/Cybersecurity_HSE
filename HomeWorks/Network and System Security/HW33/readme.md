# Итоговый отчёт по инциденту  
*Security Onion / ELSA / Zeek + Snort / Bro-FTP / Wireshark*

| Категория | Сводка |
|-----------|--------|
| **Жертва** | `209.165.200.235` (Metasploitable v2) |
| **Атакующий** | `209.165.201.17` |
| **Дата / время (UTC)** | 2017-11-13 20:30 – 20:35 |
| **Эксплойт** | Backdoor **vsftpd 2.3.4** &nbsp;→&nbsp; `USER :)` → root-shell 6200/tcp |
| **Переданный файл** | `/confidential.txt` |
| **Учётная запись FTP** | `analyst` |
| **Права, полученные злоумышленником** | `uid=0(root)` |
| **Техники MITRE ATT&CK** |  T1059 CLI · T1049 Net Discovery · T1003 OS Credential Dumping · T1098 Account Manipulation · T1105 Ingress Tool Transfer |

---

## 1. Хронология событий

| Время | Событие | Логи / сигнатуры |
|-------|---------|------------------|
| **20:31:17** | `Scan::Port_Scan` — 209.165.201.17 сканирует ≥18 портов цели | `bro_notice` |
| **20:30:54** | FTP-коннект `21/tcp`, команда **`USER :)`** | `bro_conn`, `bro_ftp` |
| **20:30:54** | Snort — **ET EXPLOIT VSFTPd Backdoor User Login Smiley** | `snort sig_msg` |
| **20:30:58** | Обратный root-shell `6200/tcp` (жертва → атакующий) | `bro_conn` dport 6200 |
| **20:31-20:33** | Команды `whoami`, `hostname`, `ifconfig` — подтверждён root-доступ | Wireshark / transcript |
| **20:31-20:33** | `cat /etc/shadow` — дамп хешей | Wireshark |
| **20:31-20:33** | Добавлена учётка **`myroot` (UID 0)** в `/etc/passwd` & `/etc/shadow` | Wireshark |
| **20:46:21** | FTP `STOR /confidential.txt` на 209.165.200.235; user **analyst** | `bro_ftp`, arg=`/confidential.txt` |
| **20:46:22** | Snort — **GPL ATTACK_RESPONSE id check returned root** (6200/tcp) | подтверждение root |
| **20:46:34** | Сессия закрыта, атакующий выходит | `bro_conn` завершается |

---

## 2. Ключевые артефакты

* **FTP 21/tcp** → `USER :)`  
  → **vsftpd 2.3.4 backdoor** (CVE-2011-2523)  
  → ответный **root-shell 6200/tcp**.  
* IDS-сигнатуры Snort/ET:  
  * *ET EXPLOIT VSFTPd Backdoor User Login Smiley*  
  * *GPL ATTACK_RESPONSE id check returned root*  
* Утечка файла **`/confidential.txt`** под пользователем **analyst**.  
* Создание скрытого пользователя **`myroot`**, UID 0 — устойчивый доступ.  
* Дамп `/etc/shadow`, последующее сканирование сети (`ifconfig`).  

---

## 3. Вывод

1. **Причина взлома:** публичный сервис vsftpd 2.3.4 с заложенным бэкдором.  
2. **Последствия:** полный root-доступ, компрометация учётных данных, загрузка/выгрузка файлов, создание постоянного root-аккаунта.  
3. **Критичность:** P1 (неограниченный контроль над сервером + утечка конфиденциальных данных).

---

## 4. Рекомендации

| Приоритет | Мера |
|-----------|------|
| **1** | Немедленно вывести хост 209.165.200.235 из сети; сохранить образ диска для форензики. |
| **2** | Удалить vsftpd 2.3.4 или обновить ≥ 2.3.5; закрыть порт 21 вовне, разрешить только по VPN. |
| **3** | Сбросить все пароли; удалить учётку `myroot`; провести аудит UID 0 в `/etc/passwd`. |
| **4** | Включить File-Integrity Monitoring (`/etc/passwd`, `/etc/shadow`, `/usr/sbin/vsftpd`). |
| **5** | Добавить IDS-правило: *21/tcp + “USER :)” ⇒ критический алерт*, а также корреляцию «FTP 21 ⇒ 6200/tcp». |
| **6** | Журналировать и блокировать любые внешние подключения к динамическим портам от сервера. |

---

## 5. Действия после анализа  

*Виртуальная машина выключена per инструкция.*  
Логи, pcap-файл и скриншоты сохранены в каталоге исследования.

