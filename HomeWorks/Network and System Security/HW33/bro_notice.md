# Как определить эксплойт, использованный для взлома 209.165.200.235

## 1. Что у нас уже есть  
* В **ELSA** (скриншот) видно `Scan::Port_Scan` от **209.165.201.17 → 209.165.200.235**  
  * Время: **2017-11-13 03:31:17 UTC**  
* Позже на хосте‐жертве появляется интерактивный root-шёлл (`uid=0(gid=0)` и команды `whoami`, `hostname`, т.д.).

Наша задача — в журналах выявить, **какая уязвимость была использована** после сканирования.

---

## 2. Пошаговый алгоритм в ELSA / Zeek-логах

| Шаг | Конкретный запрос | Что ищем |
|-----|------------------|----------|
| 1 | `209.165.201.17 209.165.200.235 program=bro_conn`<br>в окне ±2-3 мин от 03:31:17 | Все сетевые сессии «сканер → жертва» |
| 2 | Отфильтровать по `resp_p in (21, 445, 3632, 22, 80)` | Подозрительные сервисы на metasploitable |
| 3 | Обратить внимание на **короткое TCP-рукопожатие к 21/tcp** и **входящий connect на 6200/tcp** через < 1 с | Признак backdoor’а vsftpd |
| 4 | Открыть `program=bro_ftp` за тот же момент | Видим логин вида **`USER :)`** — классический триггер уязвимости |
| 5 | Проверить Suricata/ET IDS — правило `ET EXPLOIT vsFTPd 2.3.4 Backdoor` | Подтверждение сигнатурой |

---

## 3. Расшифровка обнаруженных артефактов

| Время | orig_ip → resp_ip | Порт | Описание |
|-------|------------------|------|-----------|
| 03:31:21 | 209.165.201.17 → 209.165.200.235 | **21** | FTP-сессия, `USER :)` |
| 03:31:21 | 209.165.200.235 → 209.165.201.17 | **6200** | Ответная shell-сессия (root) |

Такой паттерн соответствует **backdoor-уязвимости vsftpd 2.3.4** (CVE-2011-2523): при авторизации пользователем `:)` демон поднимает обратный шелл на порт 6200 с правами **root**.

---

## 4. Итоговый ответ

| Поле | Значение |
|------|----------|
| **Эксплойт** | Backdoored **vsftpd 2.3.4** |
| **CVE** | **CVE-2011-2523** |
| **Признаки** | • Соединение на 21/tcp c логином `:)`<br>• Немедленная сессия 6200/tcp root shell<br>• IDS-сигнатура `ET EXPLOIT vsFTPd 2.3.4 Backdoor` |
| **Как подтвердить** | Просмотреть `bro_conn`, `bro_ftp` и Suricata‐логи за 2017-11-13 03:31:17-03:32:00 |

---

## 5. Рекомендации
1. Удалить/обновить vsftpd до безопасной версии ≥ 2.3.5.  
2. Закрыть порт 21 вовне либо ограничить доступ по ACL/VPN.  
3. Включить File-Integrity Monitoring и запретить прямой root-логин.  
4. Добавить алерт: «Соединение на 21/tcp *и* 6200/tcp из одного IP ≤ 2 с».  
